<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Secure IAM Demo | Hardened Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#0a192f] text-gray-300">

    <!-- Navbar -->
    <nav class="flex justify-between items-center py-6 px-10 bg-[#0a192f] border-b border-gray-700">
        <a href="../../index.html" class="text-teal-400 text-lg font-bold">Kiran</a>
        <div class="space-x-8">
            <a href="password-vault.html" class="hover:text-teal-400">Password Vault</a>
            <a href="secure-notes.html" class="hover:text-teal-400">Secure Notes</a>
            <a href="rbac.html" class="text-teal-400">RBAC</a>
            <a href="audit.html" class="hover:text-teal-400 font-semibold">Audit Logs</a>
            <a href="../../index.html" class="hover:text-teal-400">← Back to Home</a>
        </div>
    </nav>

    <section class="px-10 py-16 max-w-5xl mx-auto">

        <h1 class="text-4xl text-teal-400 font-bold mb-6">Hardened IAM Demo</h1>
        <p class="text-gray-400 mb-10 max-w-3xl">
            This demo shows a fully hardened IAM workflow: authentication with 2FA,
            secure session handling, role-based access control, user lifecycle management,
            and audit logging — representing a real “before → after” security remediation.
        </p>

        <!-- AUTH STAGE 1: LOGIN -->
        <div id="loginBox" class="bg-[#112240] p-8 rounded-lg shadow-lg max-w-md mx-auto">

            <h2 class="text-2xl font-semibold text-gray-100 mb-4">Secure Login</h2>

            <label class="block mb-2">Username</label>
            <input id="username" 
                class="w-full px-3 py-2 rounded bg-[#0f1a2c] border border-gray-600 text-gray-200"
                placeholder="Enter username">

            <label class="block mt-4 mb-2">Password</label>
            <input id="password" type="password"
                class="w-full px-3 py-2 rounded bg-[#0f1a2c] border border-gray-600 text-gray-200"
                placeholder="Enter password">

            <button onclick="startLogin()"
                class="w-full mt-6 px-4 py-3 rounded bg-teal-400 text-black font-semibold hover:bg-teal-300 transition">
                Continue
            </button>

            <p id="loginError" class="text-red-400 mt-4 hidden">Invalid credentials.</p>
        </div>

        <!-- AUTH STAGE 2: 2FA -->
        <div id="twoFABox" class="hidden bg-[#112240] p-8 rounded-lg shadow-lg max-w-md mx-auto mt-10">
            <h2 class="text-2xl font-semibold text-gray-100 mb-4">Two-Factor Authentication</h2>

            <p class="text-gray-400 mb-4">
                A 6-digit verification code was sent to your registered device.
            </p>

            <input id="twoFACode" 
                class="w-full px-3 py-2 rounded bg-[#0f1a2c] border border-gray-600 text-gray-200"
                placeholder="Enter 6-digit code">

            <button onclick="verify2FA()"
                class="w-full mt-6 px-4 py-3 rounded bg-teal-400 text-black font-semibold hover:bg-teal-300 transition">
                Verify
            </button>

            <p id="twoFAError" class="text-red-400 mt-4 hidden">Incorrect code.</p>
        </div>


        <!-- SECURE DASHBOARD -->
        <div id="dashboard" class="hidden mt-14">

            <h2 class="text-3xl text-gray-100 font-bold mb-6">IAM Dashboard</h2>

            <!-- User Role -->
            <div class="bg-[#112240] p-6 rounded-lg shadow-md mb-8">
                <p class="text-xl text-teal-400 mb-1">Logged in as:</p>
                <p id="loggedUser" class="text-gray-300 text-lg"></p>
                <p class="mt-2">Role: <span id="roleBadge" class="text-teal-300 font-semibold"></span></p>
            </div>

            <!-- Admin Console -->
            <div id="adminConsole" class="hidden">

                <h3 class="text-2xl text-gray-100 font-bold mb-4">Admin Console</h3>

                <!-- Add User -->
                <div class="bg-[#112240] p-6 rounded-lg shadow-md mb-8">
                    <h4 class="text-xl text-gray-100 font-semibold mb-3">Create New User</h4>
                    <input id="newUser" 
                        class="w-full px-3 py-2 rounded bg-[#0f1a2c] border border-gray-600 text-gray-200 mb-4"
                        placeholder="Username">

                    <select id="newUserRole" 
                            class="w-full px-3 py-2 rounded bg-[#0f1a2c] border border-gray-600 text-gray-200">
                        <option value="user">User</option>
                        <option value="analyst">Analyst</option>
                        <option value="admin">Admin</option>
                    </select>

                    <button onclick="createUser()"
                        class="mt-4 px-4 py-2 rounded bg-teal-400 text-black font-semibold hover:bg-teal-300 transition">
                        Create User
                    </button>
                </div>

                <!-- Disable User -->
                <div class="bg-[#112240] p-6 rounded-lg shadow-md mb-8">
                    <h4 class="text-xl text-gray-100 font-semibold mb-3">Disable User</h4>

                    <select id="disableUserSelect" 
                            class="w-full px-3 py-2 rounded bg-[#0f1a2c] border border-gray-600 text-gray-200"></select>

                    <button onclick="disableUser()"
                        class="mt-4 px-4 py-2 rounded bg-red-400 text-black font-semibold hover:bg-red-300 transition">
                        Disable User
                    </button>
                </div>

            </div>

            <!-- Analyst Tools -->
            <div id="analystConsole" class="hidden bg-[#112240] p-6 rounded-lg shadow-md mb-8">
                <h3 class="text-xl text-gray-100 font-bold mb-4">Analyst Tools</h3>
                <button onclick="exportAudit()"
                    class="px-4 py-2 rounded bg-teal-400 text-black font-semibold hover:bg-teal-300 transition">
                    Export Audit Log
                </button>
            </div>

            <!-- Audit Log -->
            <div class="bg-[#112240] p-6 rounded-lg shadow-md">
                <h3 class="text-2xl text-gray-100 font-bold mb-4">Audit Log</h3>
                <ul id="auditList" class="text-gray-400 text-sm space-y-2"></ul>
            </div>

        </div>

    </section>


    <script>
        /*  
           Simulated Secure Backend:
           - Hashed passwords
           - 2FA code validation
           - RBAC roles
           - Account lifecycle
        */
        const users = {
            "admin": { passwordHash: "hash_admin", role: "admin", enabled: true },
            "kiran": { passwordHash: "hash_kiran", role: "user", enabled: true },
            "analyst1": { passwordHash: "hash_analyst", role: "analyst", enabled: true }
        };

        let pendingUser = null;     
        let generatedCode = "123456"; // Simulated 2FA code

        function sanitize(input) {
            return input.replace(/[<>]/g, "");
        }

        function startLogin() {
            const user = sanitize(document.getElementById("username").value.trim().toLowerCase());
            const pass = sanitize(document.getElementById("password").value.trim());

            if (!users[user] || users[user].passwordHash !== ("hash_" + pass)) {
                document.getElementById("loginError").classList.remove("hidden");
                return;
            }

            if (!users[user].enabled) {
                alert("Account disabled.");
                return;
            }

            pendingUser = user;

            // Switch to 2FA screen
            document.getElementById("loginBox").classList.add("hidden");
            document.getElementById("twoFABox").classList.remove("hidden");

            logEvent(`2FA code sent to ${user}`);
        }

        function verify2FA() {
            const code = sanitize(document.getElementById("twoFACode").value.trim());

            if (code !== generatedCode) {
                document.getElementById("twoFAError").classList.remove("hidden");
                return;
            }

            // Establish secure session
            sessionStorage.setItem("user", pendingUser);

            document.getElementById("twoFABox").classList.add("hidden");
            document.getElementById("dashboard").classList.remove("hidden");

            loadDashboard();
            logEvent(`${pendingUser} successfully authenticated with 2FA`);
        }


        function loadDashboard() {
            const user = sessionStorage.getItem("user");
            const role = users[user].role;

            document.getElementById("loggedUser").innerText = user;
            document.getElementById("roleBadge").innerText = role;

            // RBAC
            if (role === "admin") {
                document.getElementById("adminConsole").classList.remove("hidden");
                populateDisableUserDropdown();
            }

            if (role === "analyst") {
                document.getElementById("analystConsole").classList.remove("hidden");
            }
        }


        function createUser() {
            const user = sanitize(document.getElementById("newUser").value.trim());
            const role = document.getElementById("newUserRole").value;

            if (!user) return alert("Username required");

            users[user] = { passwordHash: "hash_default", role, enabled: true };

            populateDisableUserDropdown();
            logEvent(`Admin created new user: ${user} with role ${role}`);

            alert("User created securely.");
        }


        function disableUser() {
            const user = document.getElementById("disableUserSelect").value;

            if (user === "admin") {
                alert("Cannot disable admin.");
                return;
            }

            users[user].enabled = false;

            populateDisableUserDropdown();
            logEvent(`Admin DISABLED user: ${user}`);

            alert("User disabled securely.");
        }


        function exportAudit() {
            logEvent("Analyst exported audit log");

            let exportText = "";
            document.querySelectorAll("#auditList li").forEach(li => {
                exportText += li.textContent + "\n";
            });

            alert("Exported Log:\n\n" + exportText);
        }


        function populateDisableUserDropdown() {
            const dropdown = document.getElementById("disableUserSelect");
            dropdown.innerHTML = "";

            Object.keys(users).forEach(u => {
                if (users[u].enabled) {
                    const option = document.createElement("option");
                    option.value = u;
                    option.textContent = u;
                    dropdown.appendChild(option);
                }
            });
        }


        function logEvent(event) {
            const list = document.getElementById("auditList");
            const li = document.createElement("li");
            li.textContent = new Date().toISOString() + " — " + event;
            list.appendChild(li);
        }
    </script>

</body>
</html>
