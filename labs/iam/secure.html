<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Secure Demo | IAM + RBAC + Audit Logs</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#0a192f] text-gray-300">

    <!-- Navbar -->
    <nav class="flex justify-between items-center py-6 px-10 bg-[#0a192f] border-b border-gray-700">
        <a href="../../index.html" class="text-teal-400 text-lg font-bold">Kiran</a>
        <div class="space-x-8">
            <a href="password-vault.html" class="hover:text-teal-400">Password Vault</a>
            <a href="secure-notes.html" class="hover:text-teal-400">Secure Notes</a>
            <a href="rbac.html" class="text-teal-400">RBAC</a>
            <a href="audit.html" class="hover:text-teal-400 font-semibold">Audit Logs</a>
            <a href="../../index.html" class="hover:text-teal-400">← Back to Home</a>
        </div>
    </nav>
    
    <!-- Header-->
    <section class="px-10 py-16 max-w-4xl mx-auto">

        <h1 class="text-4xl text-teal-400 font-bold mb-6">Secure Version</h1>
        <p class="text-gray-400 mb-10 max-w-2xl">
            This page demonstrates a secure IAM design using proper authentication, 
            role-based access control, input validation, and audited actions.
        </p>

        <!-- LOGIN BOX -->
        <div id="loginBox" class="bg-[#112240] p-8 rounded-lg shadow-lg max-w-md mx-auto">

            <h2 class="text-2xl font-semibold text-gray-100 mb-4">Secure Login</h2>

            <label class="block mb-2">Username</label>
            <input id="username" 
                   class="w-full px-3 py-2 rounded bg-[#0f1a2c] border border-gray-600 text-gray-200"
                   placeholder="Enter username">

            <label class="block mt-4 mb-2">Password</label>
            <input id="password" type="password"
                   class="w-full px-3 py-2 rounded bg-[#0f1a2c] border border-gray-600 text-gray-200"
                   placeholder="Enter password">

            <button onclick="secureLogin()"
                class="w-full mt-6 px-4 py-3 rounded bg-teal-400 text-black font-semibold hover:bg-teal-300 transition">
                Login Securely
            </button>

            <p id="loginError" class="text-red-400 mt-4 hidden">Invalid credentials.</p>
        </div>

        <!-- SECURE DASHBOARD -->
        <div id="dashboard" class="hidden mt-14">

            <h2 class="text-3xl text-gray-100 font-bold mb-6">Secure Dashboard</h2>

            <p class="text-gray-400 mb-6">
                Welcome! Your role determines what actions you can perform.
            </p>

            <!-- RBAC Permissions Display -->
            <div class="bg-[#112240] p-6 rounded-lg shadow-md mb-10">
                <h3 class="text-xl text-teal-400 font-bold mb-3">Your Role: <span id="role"></span></h3>
                <p class="text-gray-400">This determines which UI elements appear and which actions are allowed.</p>
            </div>

            <!-- Admin Only Action -->
            <div id="adminPanel" class="hidden bg-[#112240] p-6 rounded-lg shadow-md mb-10">
                <h3 class="text-xl text-gray-100 font-bold mb-3">Admin Actions</h3>
                <button onclick="performAdminAction()"
                    class="px-4 py-2 rounded bg-red-400 text-black font-semibold hover:bg-red-300 transition">
                    Delete User (Protected Action)
                </button>
            </div>

            <!-- Normal User Action -->
            <div id="userPanel" class="bg-[#112240] p-6 rounded-lg shadow-md mb-10">
                <h3 class="text-xl text-gray-100 font-bold mb-3">User Actions</h3>
                <button onclick="performUserAction()"
                    class="px-4 py-2 rounded bg-teal-400 text-black font-semibold hover:bg-teal-300 transition">
                    View Profile
                </button>
            </div>

            <!-- Audit Log -->
            <div class="bg-[#112240] p-6 rounded-lg shadow-md mt-10">
                <h3 class="text-xl text-gray-100 font-bold mb-4">Audit Log</h3>
                <ul id="auditList" class="text-gray-400 text-sm space-y-2"></ul>
            </div>

        </div>

    </section>

    <script>
        // Simulated "database" of hashed passwords (fake hashes for demo)
        const users = {
            "admin": { passwordHash: "hash_admin_123", role: "admin" },
            "kiran": { passwordHash: "hash_kiran_123", role: "user" }
        };

        function sanitize(input) {
            return input.replace(/[<>]/g, "");
        }

        function secureLogin() {
            const user = sanitize(document.getElementById("username").value.trim().toLowerCase());
            const pass = sanitize(document.getElementById("password").value.trim());

            const userRecord = users[user];
            if (!userRecord || ("hash_" + pass + "_123") !== userRecord.passwordHash) {
                document.getElementById("loginError").classList.remove("hidden");
                return;
            }

            // Store session securely (demo only)
            window.sessionStorage.setItem("user", user);

            // Show dashboard
            document.getElementById("loginBox").classList.add("hidden");
            document.getElementById("dashboard").classList.remove("hidden");

            document.getElementById("role").innerText = userRecord.role;

            // RBAC Enforcement
            if (userRecord.role === "admin") {
                document.getElementById("adminPanel").classList.remove("hidden");
            }

            logEvent("User logged in securely");
        }

        function performAdminAction() {
            const user = sessionStorage.getItem("user");
            if (users[user].role !== "admin") return;

            logEvent("Admin executed secure delete action");
            alert("Secure: User deletion simulated.");
        }

        function performUserAction() {
            logEvent("User viewed profile");
            alert("Profile viewed securely.");
        }

        function logEvent(event) {
            const list = document.getElementById("auditList");
            const li = document.createElement("li");
            li.textContent = new Date().toISOString() + " — " + event;
            list.appendChild(li);
        }
    </script>

</body>
</html>
