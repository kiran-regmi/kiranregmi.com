<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Cybersecurity Voice Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .container {
            max-width: 700px;
            width: 100%;
            text-align: center;
        }

        .title {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            animation: fadeIn 0.8s ease;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #a0aec0;
            margin-bottom: 2rem;
            animation: fadeIn 0.8s ease 0.2s backwards;
        }

        .permission-notice {
            background: rgba(237, 137, 54, 0.2);
            border: 1px solid rgba(237, 137, 54, 0.4);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
            color: #f6ad55;
            font-size: 0.9rem;
            display: none;
        }

        .permission-notice.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .agent-status {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            animation: fadeIn 0.8s ease 0.4s backwards;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #48bb78;
            animation: pulse 2s infinite;
        }

        .status-dot.listening {
            background: #f56565;
        }

        .status-dot.thinking {
            background: #ed8936;
        }

        .talk-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
            margin: 0 auto 1.5rem;
            display: block;
        }

        .talk-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 15px 50px rgba(102, 126, 234, 0.6);
        }

        .talk-button:active:not(:disabled) {
            transform: scale(0.98);
        }

        .talk-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .talk-button.listening {
            background: linear-gradient(135deg, #f56565 0%, #ed8936 100%);
            animation: pulseButton 1.5s infinite;
        }

        .talk-button.thinking {
            background: linear-gradient(135deg, #ed8936 0%, #f6ad55 100%);
        }

        .mic-icon {
            font-size: 3rem;
        }

        .input-method {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .method-btn {
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #667eea;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .method-btn.active {
            background: rgba(102, 126, 234, 0.4);
            border-color: #667eea;
        }

        .method-btn:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        .text-input-container {
            display: none;
            margin-top: 1rem;
        }

        .text-input-container.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .text-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 10px;
            padding: 1rem;
            color: white;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .text-input::placeholder {
            color: #a0aec0;
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .transcript-container {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            min-height: 150px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 2rem;
            text-align: left;
            display: none;
        }

        .transcript-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
            animation: slideIn 0.3s ease;
        }

        .message.user {
            background: rgba(102, 126, 234, 0.2);
            border-left: 3px solid #667eea;
        }

        .message.agent {
            background: rgba(72, 187, 120, 0.2);
            border-left: 3px solid #48bb78;
        }

        .message-label {
            font-size: 0.8rem;
            color: #a0aec0;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .message-text {
            color: #cbd5e0;
            line-height: 1.6;
        }

        .capabilities {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            animation: fadeIn 0.8s ease 0.6s backwards;
        }

        .capabilities h3 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .capabilities ul {
            list-style: none;
            color: #cbd5e0;
            text-align: left;
        }

        .capabilities li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .capabilities li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #48bb78;
            font-weight: bold;
        }

        .error-message {
            background: rgba(245, 101, 101, 0.2);
            border: 1px solid rgba(245, 101, 101, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            color: #f56565;
            display: none;
        }

        .error-message.active {
            display: block;
            animation: shake 0.5s ease;
        }

        .back-link {
            position: fixed;
            top: 2rem;
            left: 2rem;
            color: #667eea;
            text-decoration: none;
            font-size: 1rem;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: #764ba2;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        @keyframes pulseButton {
            0%, 100% {
                box-shadow: 0 10px 40px rgba(245, 101, 101, 0.4);
            }
            50% {
                box-shadow: 0 15px 50px rgba(245, 101, 101, 0.8);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>
    <a href="7dayai.html" class="back-link">‚Üê Back to Portfolio</a>

    <div class="container">
        <h1 class="title">AI Cybersecurity Assistant</h1>
        <p class="subtitle">Ask me anything about cybersecurity, GRC, or AI governance</p>

        <div class="permission-notice" id="permissionNotice">
            ‚ö†Ô∏è Microphone access required. Please allow when prompted, or use text input below.
        </div>

        <div class="agent-status">
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Ready to talk</span>
            </div>

            <div class="input-method">
                <button class="method-btn active" id="voiceBtn" onclick="switchMode('voice')">üéôÔ∏è Voice</button>
                <button class="method-btn" id="textBtn" onclick="switchMode('text')">‚å®Ô∏è Type</button>
            </div>

            <div id="voiceMode">
                <button class="talk-button" id="talkButton">
                    <span class="mic-icon" id="micIcon">üéôÔ∏è</span>
                </button>
                <p style="color: #a0aec0; font-size: 0.9rem;">Click once to start, click again to end conversation</p>
            </div>

            <div class="text-input-container" id="textMode">
                <input type="text" class="text-input" id="textInput" placeholder="Type your cybersecurity question here...">
                <button class="send-btn" onclick="sendTextMessage()">Send Message</button>
            </div>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="transcript-container" id="transcriptContainer"></div>

        <div class="capabilities">
            <h3>I can help you with:</h3>
            <ul>
                <li>Cybersecurity threats and risk management</li>
                <li>GRC frameworks (SOC 2, NIST, ISO 27001)</li>
                <li>AI security and governance best practices</li>
                <li>Third-party risk management (TPRM)</li>
                <li>Compliance and audit preparation</li>
                <li>Security controls and implementations</li>
            </ul>
        </div>
    </div>

    <script>
        const talkButton = document.getElementById('talkButton');
        const micIcon = document.getElementById('micIcon');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const transcriptContainer = document.getElementById('transcriptContainer');
        const errorMessage = document.getElementById('errorMessage');
        const permissionNotice = document.getElementById('permissionNotice');
        const textInput = document.getElementById('textInput');

        let recognition = null;
        let isListening = false;
        let conversationHistory = [];
        let currentMode = 'voice';
        let isSpeaking = false;
        let currentUtterance = null;
        let continuousMode = false;

        function switchMode(mode) {
            currentMode = mode;
            const voiceBtn = document.getElementById('voiceBtn');
            const textBtn = document.getElementById('textBtn');
            const voiceMode = document.getElementById('voiceMode');
            const textMode = document.getElementById('textMode');

            if (mode === 'voice') {
                voiceBtn.classList.add('active');
                textBtn.classList.remove('active');
                voiceMode.style.display = 'block';
                textMode.classList.remove('active');
                initSpeechRecognition();
            } else {
                textBtn.classList.add('active');
                voiceBtn.classList.remove('active');
                voiceMode.style.display = 'none';
                textMode.classList.add('active');
            }
        }

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true; // Keep listening continuously
                recognition.interimResults = true; // Get interim results for interruption detection
                recognition.lang = 'en-US';

                recognition.onstart = () => {
                    isListening = true;
                    continuousMode = true;
                    talkButton.classList.add('listening');
                    statusDot.classList.add('listening');
                    statusText.textContent = 'Listening continuously...';
                    micIcon.textContent = 'üî¥';
                    permissionNotice.classList.remove('active');
                };

                recognition.onresult = async (event) => {
                    const lastResultIndex = event.results.length - 1;
                    const transcript = event.results[lastResultIndex][0].transcript.toLowerCase().trim();
                    
                    // Check for stop/interrupt commands
                    if (isSpeaking && (
                        transcript.includes('stop') || 
                        transcript.includes('wait') ||
                        transcript.includes('hold on') ||
                        transcript.includes('pause') ||
                        transcript.includes('quiet')
                    )) {
                        window.speechSynthesis.cancel();
                        isSpeaking = false;
                        statusText.textContent = 'Listening continuously...';
                        return; // Don't process these as questions
                    }

                    // Only process final results (not interim)
                    if (event.results[lastResultIndex].isFinal) {
                        // Filter out command-only phrases
                        if (shouldIgnorePhrase(transcript)) {
                            return;
                        }

                        // Wait for agent to finish speaking before processing new question
                        if (isSpeaking) {
                            return; // Skip if still speaking
                        }

                        addMessage('user', event.results[lastResultIndex][0].transcript);
                        
                        // Small delay to ensure smooth transition
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                        await getAIResponse(event.results[lastResultIndex][0].transcript);
                    }
                };

                recognition.onerror = (event) => {
                    if (event.error === 'not-allowed') {
                        permissionNotice.classList.add('active');
                        showError('Microphone access denied. Please enable microphone in browser settings or use text input.');
                        continuousMode = false;
                    } else if (event.error !== 'no-speech' && event.error !== 'aborted') {
                        showError(`Error: ${event.error}. Please try again or use text input.`);
                    }
                };

                recognition.onend = () => {
                    // Auto-restart if in continuous mode
                    if (continuousMode && !isSpeaking) {
                        try {
                            recognition.start();
                        } catch (e) {
                            // Already started, ignore
                        }
                    } else if (!continuousMode) {
                        resetButton();
                    }
                };
            } else {
                showError('Speech recognition not supported. Using text input mode.');
                switchMode('text');
            }
        }

        function shouldIgnorePhrase(transcript) {
            const ignorePatterns = [
                /^(stop|wait|hold on|pause|quiet|shh|hmm|um|uh)$/i,
                /^(okay|ok|yeah|yes|no|nope)$/i,
                /^(hey|hello|hi)$/i
            ];
            
            return ignorePatterns.some(pattern => pattern.test(transcript));
        }

        talkButton.addEventListener('click', () => {
            // Stop everything if clicking to end conversation
            if (continuousMode) {
                continuousMode = false;
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }
                if (recognition) {
                    recognition.stop();
                }
                isSpeaking = false;
                isListening = false;
                resetButton();
                statusText.textContent = 'Conversation ended. Click to start again.';
                return;
            }

            if (!recognition) {
                initSpeechRecognition();
            }
            
            if (!recognition) {
                switchMode('text');
                return;
            }

            try {
                recognition.start();
                transcriptContainer.classList.add('active');
            } catch (error) {
                if (error.message.includes('already started')) {
                    // Already running, ignore
                } else {
                    showError('Could not start microphone. Using text input.');
                    switchMode('text');
                }
            }
        });

        textInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendTextMessage();
            }
        });

        async function sendTextMessage() {
            const message = textInput.value.trim();
            if (!message) return;

            textInput.value = '';
            addMessage('user', message);
            transcriptContainer.classList.add('active');
            await getAIResponse(message);
        }

        async function getAIResponse(userMessage) {
            statusDot.classList.remove('listening');
            statusDot.classList.add('thinking');
            statusText.textContent = 'Thinking...';
            if (currentMode === 'voice') {
                talkButton.classList.remove('listening');
                talkButton.classList.add('thinking');
                micIcon.textContent = '‚è≥';
            }

            // Stop any ongoing speech
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }

            try {
                const aiResponse = generateIntelligentResponse(userMessage);

                conversationHistory.push(
                    { role: 'user', content: userMessage },
                    { role: 'assistant', content: aiResponse }
                );

                addMessage('agent', aiResponse);
                
                if (currentMode === 'voice') {
                    speakResponse(aiResponse);
                }

            } catch (error) {
                showError('Something went wrong. Please try again.');
                console.error('Error:', error);
            }

            resetButton();
        }

        function generateIntelligentResponse(question) {
            const q = question.toLowerCase().trim();
            const lastUserMessage = conversationHistory.length > 1 ? 
                conversationHistory[conversationHistory.length - 2].content.toLowerCase() : '';
            
            // Questions about Kiran Regmi
            if (q.includes('kiran') || q.includes('who created') || q.includes('who made')) {
                if (q.includes('who is kiran') || q.includes('kiran regmi')) {
                    return "Kiran Regmi is a cybersecurity and GRC analyst specializing in AI governance, compliance frameworks, and risk management. He builds AI-powered solutions for security operations and governance automation. He's passionate about responsible AI implementation and helping organizations navigate the intersection of AI technology and governance.";
                }
                if (q.includes('what does he do') || q.includes('what does kiran do')) {
                    return "Kiran works on cybersecurity and GRC projects, focusing on AI governance, compliance automation, and building intelligent security tools. He specializes in frameworks like SOC 2, NIST AI RMF, and ISO 27001, and develops AI agents to solve real-world security and compliance challenges.";
                }
                if (q.includes('how do you know') || q.includes('tell me about')) {
                    return "Kiran created me as part of his seven-day AI challenge. He built me to demonstrate practical applications of AI in cybersecurity and governance. I'm designed to help people understand security frameworks and GRC concepts.";
                }
                return "I was created by Kiran Regmi, a cybersecurity and GRC professional who specializes in AI governance and compliance automation. He's working on innovative solutions at the intersection of AI and cybersecurity.";
            }
            
            // Natural greetings and pleasantries
            if (q.match(/^(good morning|good afternoon|good evening)$/i)) {
                const hour = new Date().getHours();
                if (hour < 12) return "Good morning! How can I help you today?";
                if (hour < 18) return "Good afternoon! What can I do for you?";
                return "Good evening! What brings you here?";
            }
            
            if (q.match(/^(hello|hi|hey|howdy)$/i)) {
                return "Hi there! What can I help you with?";
            }
            
            if (q.includes('how are you') || q.includes('how\'re you')) {
                return "I'm doing well, thanks for asking! What would you like to know?";
            }
            
            // Weather - be honest but helpful
            if (q.includes('weather')) {
                return "I can't check the weather, but I'd be happy to help with cybersecurity questions. What would you like to know?";
            }
            
            // Day/Date
            if (q.includes('what day') || q.includes('what\'s the day') || q.includes('date today')) {
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                const now = new Date();
                const day = days[now.getDay()];
                const month = months[now.getMonth()];
                const date = now.getDate();
                const year = now.getFullYear();
                return `Today is ${day}, ${month} ${date}, ${year}. Do you have any cybersecurity questions?`;
            }
            
            // Conversational commands
            if (q === 'stop' || q === 'wait' || q === 'hold on' || q === 'pause') {
                return "Okay.";
            }
            
            if (q === 'thank you' || q === 'thanks' || q === 'got it' || q === 'okay') {
                return "You're welcome!";
            }
            
            if (q === 'goodbye' || q === 'bye' || q === 'see you') {
                return "Goodbye! Feel free to come back anytime.";
            }

            // Check if question is cybersecurity-related
            const cybersecurityKeywords = [
                'security', 'cyber', 'hack', 'risk', 'compliance', 'grc', 'governance',
                'audit', 'control', 'threat', 'vulnerability', 'encryption', 'authentication',
                'firewall', 'malware', 'phishing', 'ransomware', 'breach', 'incident',
                'nist', 'iso', 'soc', 'gdpr', 'hipaa', 'pci', 'policy', 'framework',
                'ai security', 'data protection', 'privacy', 'pen test', 'penetration',
                'zero trust', 'access control', 'identity', 'tprm', 'vendor', 'third party',
                'attack', 'defense', 'secure', 'protect', 'monitor', 'detect', 'respond'
            ];
            
            const isRelevant = cybersecurityKeywords.some(keyword => q.includes(keyword)) ||
                             q.includes('what is') || q.includes('how do') || q.includes('can you explain') ||
                             q.includes('tell me about');
            
            // Handle off-topic questions gracefully
            if (!isRelevant && q.length > 8 && !q.includes('help')) {
                return "I focus on cybersecurity and GRC. Is there anything in that area I can help with?";
            }

            // Handle follow-up context
            if ((q.includes('more') || q.includes('else') || q.includes('also') || q.includes('additionally')) && 
                lastUserMessage.length > 0) {
                if (lastUserMessage.includes('soc 2')) {
                    return "Most organizations need 3 to 6 months to prepare. Engage stakeholders early, document thoroughly, and consider hiring a consultant for your first audit.";
                }
                if (lastUserMessage.includes('ransomware')) {
                    return "Also implement application whitelisting, restrict PowerShell, maintain offline backups, and test your recovery process regularly.";
                }
            }

            // GRC responses - concise
            if (q.includes('grc')) {
                if (q.includes('implement') || q.includes('start')) {
                    return "Start with executive sponsorship, conduct a risk assessment, document compliance requirements, and choose a GRC platform. Focus on quick wins first.";
                }
                if (q.includes('tool') || q.includes('software')) {
                    return "Popular options include ServiceNow GRC, RSA Archer, and MetricStream. For smaller companies, try Vanta, Drata, or Secureframe.";
                }
                return "GRC means Governance, Risk, and Compliance. It integrates strategic direction, risk management, and regulatory compliance into one framework.";
            }
            
            // SOC 2
            if (q.includes('soc 2') || q.includes('soc2')) {
                if (q.includes('type 1') || q.includes('type 2') || q.includes('difference')) {
                    return "Type 1 checks controls at one point in time. Type 2 tests them over 6 to 12 months. Most customers prefer Type 2.";
                }
                if (q.includes('cost') || q.includes('expensive')) {
                    return "Audits run 20 to 100 thousand dollars depending on size and complexity. Factor in remediation and consultant costs too.";
                }
                return "SOC 2 evaluates service organizations on Security, Availability, Processing Integrity, Confidentiality, and Privacy. Essential for SaaS companies.";
            }

            // NIST AI RMF
            if (q.includes('nist') && (q.includes('ai') || q.includes('rmf'))) {
                return "NIST AI RMF has four functions: GOVERN for oversight, MAP to identify risks, MEASURE to track them, and MANAGE to mitigate them.";
            }

            // ISO 27001
            if (q.includes('iso 27001') || q.includes('iso27001')) {
                if (q.includes('controls') || q.includes('annex')) {
                    return "Annex A has 93 controls across organizational, people, physical, and technological domains. You select based on your risk assessment.";
                }
                if (q.includes('cost')) {
                    return "Certification costs 15 to 100 thousand dollars. Budget for consultants, implementation, and annual audits. Recertification is every 3 years.";
                }
                return "ISO 27001 defines requirements for an information security management system. Certification requires external audit and demonstrates commitment to security.";
            }

            // TPRM
            if (q.includes('tprm') || q.includes('third party risk') || q.includes('vendor risk')) {
                return "Assess vendors through questionnaires, review their SOC 2 reports, check references, define security SLAs, and monitor continuously.";
            }

            // Ransomware
            if (q.includes('ransomware')) {
                if (q.includes('attacked') || q.includes('hit')) {
                    return "Isolate affected systems immediately, don't pay, notify law enforcement, activate your incident response plan, and restore from backups.";
                }
                return "Defend with offline backups, endpoint detection, email filtering, security training, network segmentation, and least privilege access.";
            }

            // Zero Trust
            if (q.includes('zero trust')) {
                return "Zero trust means verify everything, trust nothing. Enforce least privilege, segment networks, require strong authentication, and monitor continuously.";
            }

            // Phishing
            if (q.includes('phishing')) {
                return "Combat phishing with regular training, simulated campaigns, email filtering, multi-factor authentication, and easy incident reporting.";
            }

            // Incident Response
            if (q.includes('incident response')) {
                return "Build capability with defined roles, documented playbooks, 24/7 contacts, evidence procedures, and regular tabletop exercises.";
            }

            // Penetration Testing
            if (q.includes('penetration test') || q.includes('pentest')) {
                return "Test at least annually, after major changes, and before launches. Use qualified testers and ensure clear scope and authorization.";
            }

            // MFA
            if (q.includes('mfa') || q.includes('multi-factor') || q.includes('2fa')) {
                return "MFA requires two or more verifications: password, token, or biometrics. Use authenticator apps over SMS. Reduces breach risk by 99 percent.";
            }

            // GDPR
            if (q.includes('gdpr')) {
                return "GDPR requires consent, 72-hour breach notification, data subject rights, privacy by design, and a DPO for high-risk processing.";
            }

            // Encryption
            if (q.includes('encrypt') && !q.includes('ransomware')) {
                return "Use AES-256 for data at rest, TLS 1.2 or higher in transit. Implement proper key management and encrypt sensitive data and backups.";
            }

            // Access Control
            if (q.includes('access control') || q.includes('least privilege')) {
                return "Give users only the access they need. Use role-based control, regular reviews, and remove access when roles change.";
            }

            // Cloud Security
            if (q.includes('cloud security') || q.includes('aws') || q.includes('azure')) {
                return "Use strong identity management, encrypt data, enable logging, segment networks, and understand the shared responsibility model.";
            }

            // Business Continuity
            if (q.includes('business continuity') || q.includes('disaster recovery')) {
                return "Identify critical functions, set recovery objectives, document procedures, maintain backups, and test regularly.";
            }

            // Vulnerability Management
            if (q.includes('vulnerability') && (q.includes('manage') || q.includes('scan'))) {
                return "Scan regularly, prioritize by risk, patch critical issues within days, use compensating controls when needed, and monitor continuously.";
            }

            // Risk Assessment
            if (q.includes('risk assessment')) {
                return "Identify assets, analyze threats and vulnerabilities, assess likelihood and impact, score risks, and decide to accept, mitigate, transfer, or avoid.";
            }

            // General help or unclear
            if (q.includes('help') || q.length < 10) {
                return "I can help with cybersecurity topics like SOC 2, ISO 27001, NIST frameworks, risk management, and security best practices. What interests you?";
            }

            // Catch-all
            return "I can help with that. Could you be more specific about what you'd like to know?";
        }

        function speakResponse(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.rate = 0.85; // Slower, more natural pace
                currentUtterance.pitch = 1.0;
                currentUtterance.volume = 1;
                
                currentUtterance.onstart = () => {
                    isSpeaking = true;
                    statusText.textContent = 'Speaking... (say "stop" to interrupt)';
                };

                currentUtterance.onend = () => {
                    isSpeaking = false;
                    // Add pause after speaking before listening again
                    setTimeout(() => {
                        if (continuousMode) {
                            statusText.textContent = 'Listening continuously...';
                        }
                    }, 1000); // 1 second pause
                    currentUtterance = null;
                };

                currentUtterance.onerror = () => {
                    isSpeaking = false;
                    statusText.textContent = 'Listening continuously...';
                };

                // Delay before speaking to ensure clean audio
                setTimeout(() => {
                    if (currentUtterance) {
                        window.speechSynthesis.speak(currentUtterance);
                    }
                }, 300);
            }
        }

        function addMessage(type, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const label = document.createElement('div');
            label.className = 'message-label';
            label.textContent = type === 'user' ? 'You:' : 'AI Assistant:';
            
            const content = document.createElement('div');
            content.className = 'message-text';
            content.textContent = text;
            
            messageDiv.appendChild(label);
            messageDiv.appendChild(content);
            transcriptContainer.appendChild(messageDiv);
            
            transcriptContainer.scrollTop = transcriptContainer.scrollHeight;
        }

        function resetButton() {
            isListening = false;
            talkButton.classList.remove('listening', 'thinking');
            statusDot.classList.remove('listening', 'thinking');
            statusText.textContent = 'Ready to talk';
            micIcon.textContent = 'üéôÔ∏è';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('active');
            setTimeout(() => {
                errorMessage.classList.remove('active');
            }, 5000);
        }

        // Initialize
        initSpeechRecognition();
    </script>
</body>
</html>